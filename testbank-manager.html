<!DOCTYPE html>
<!-- Credits
    https://www.js-tutorials.com/javascript-tutorial/reading-csv-file-using-javascript-html5/
    I used the code to make the HTML form which uploaded the CSV file and displayed it.
   
-->
<html>
    <head>
        <title>Testbank Manager</title>
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
        <script src="https://unpkg.com/papaparse@latest/papaparse.min.js"></script>
        <meta name="description" content="Testbank Manager">
    </head>

    <body>
        <header> <!-- Header-->
                <nav>
                    <ul>
                        <li><a href="teacher-dash.html">HOME</a></li>
                        <li>LOG OUT</li>
                    </ul>
                </nav>
                <hr>
        </header>

        <section>
            <div>
                <a href="excelTemplate.xlsx" download>Download the Excel Template</a>
            </div>
            <br>
            <form class="form-inline">
                <div class="form-group">
                  <label for="files">Upload CSV file:</label>
                  <input type="file" id="files"  class="form-control" accept=".csv" required />
                </div>
                <div class="form-group">
                 <button type="submit" onclick="showSave()" id="submit-file" class="btn btn-primary">Upload File</button>
                 </div>
            </form>

            <br>

            <div id = "tableName"></div>
            <div class="row" id="parsed_csv_list"></div>

            <div id = "hidden" style="display:none"> 
                <label for="tname">Name Testbank:</label>
                <input type="text" id="tname"  class="form-control" required/>
                <button type="submit" id="save-testbank" onclick="getName()" class="btn btn-primary">SAVE</button>

            </div>
              <!--Add save button which uploads to database-->   
            
        </section>
    </body>
</html>

<script type="text/javascript">

    function getName() {
        
        var x = document.getElementById('tname').value;
        if(x == "") {
            alert("Please Fill The Field")
            return;
        }
        showSave();
        document.getElementById('tableName').innerHTML = x;
    }


    function showSave() {
        var x = document.getElementById('hidden');
        if(x.style.display == 'none') {
            x.style.display = 'block';
        }
        else {
            x.style.display = 'none';
        }
    }

    $(document).ready(function() {
        $('#submit-file').on("click", function(e) {
            e.preventDefault();
            $('#files').parse({
                config: {
                    delimiter: "auto",
                    complete: displayHTMLTable,
                },
                before: function(file, inputElem)
                {
                    //console.log("Parsing file...", file);
                },
                error: function(err, file)
                {
                    //console.log("ERROR:", err, file);
                },
                complete: function()
                {
                    //console.log("Done with all files");
                }
             });
        });

    function displayHTMLTable(results){
        var table = "<table class='table'>";
        var data = results.data;
        
        for(i=0;i<data.length;i++){
            table+= "<tr>";
            var row = data[i];
            var cells = row.join(",").split(",");
            
            for(j=0;j<cells.length;j++){
                table+= "<td>";
                table+= cells[j];
                table+= "</th>";
            }
            table+= "</tr>";
        }
        table+= "</table>";
        
        $("#parsed_csv_list").html(table);
    }

    });
</script>